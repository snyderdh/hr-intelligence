<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canopy</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-org-chart@2.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN NAV -->
<nav id="mainNav">
    <div class="nav-brand">
        <div class="brand-icon">
            <svg class="brand-tree" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 3 L19 11 H15 L19 17 H13.5 L13.5 21 H10.5 L10.5 17 H5 L9 11 H5 Z" fill="white" opacity="0.95"/>
            </svg>
        </div>
        <div class="brand-name">Canopy</div>
    </div>
    <div class="nav-links">
        <button class="nav-link active" id="nlHome"       onclick="showPage('home')">Home</button>
        <button class="nav-link"        id="nlOrgHealth"      onclick="showPage('orgHealth')">Org Health</button>
        <button class="nav-link"        id="nlCompensation"   onclick="showPage('compensation')">Compensation</button>
        <button class="nav-link"        id="nlOrgchart"       onclick="showPage('orgchart')">Org Chart</button>
        <button class="nav-link"        id="nlScenarioStudio"  onclick="showPage('scenarioStudio')">Workforce Planning</button>
        <button class="nav-link"        id="nlDashboard"       onclick="showPage('dashboard')">Dashboard</button>
    </div>
    <div class="nav-actions">
        <button class="top-btn primary" onclick="toggleAI()">âœ¦ Ask Claude</button>
    </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SUB-NAV BAR -->
<div id="navSubBar">
    <button id="navBack" class="nav-sub-btn" onclick="navGoBack()">â†</button>
    <button id="navFwd"  class="nav-sub-btn" onclick="navGoFwd()">â†’</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: HOME -->
<div id="pageHome" class="page active">

    <!-- Hero metric strip -->
    <div id="homeHero">
        <div class="hero-metric">
            <span id="statHC">â€”</span>
            <label>Headcount</label>
        </div>
        <div class="hero-metric">
            <span id="statPayroll">â€”</span>
            <label>Payroll</label>
        </div>
        <div class="hero-metric">
            <span id="statAvgSal">â€”</span>
            <label>Avg Salary</label>
        </div>
        <div class="hero-metric">
            <span id="statTenure">â€”</span>
            <label>Avg Tenure</label>
        </div>
        <div class="hero-metric">
            <span id="statSpan">â€”</span>
            <label>Span : 1</label>
        </div>
        <div class="hero-metric">
            <span id="homeHealthScore">â€”</span>
            <label>Org Health</label>
        </div>
        <div class="hero-actions">
            <label class="toolbar-upload" for="fileInput">ğŸ“ Load Your Data</label>
            <input type="file" id="fileInput" accept=".csv" style="display:none">
            <span id="demoBadge" class="demo-badge">Demo Data</span>
        </div>
    </div>

    <!-- Insight cards (4-up) -->
    <div id="homeCards">
        <div class="insight-card" id="cardHealth" onclick="showPage('orgHealth')" style="cursor:pointer;">
            <div class="insight-card-title">Org Health</div>
            <div class="insight-val" id="cardHealthScore">â€”</div>
            <div class="insight-sub" id="cardHealthSub">Load data to see org health signals</div>
            <div class="insight-list" id="cardHealthList"></div>
            <div class="oh-card-link">View Details â†’</div>
        </div>
        <div class="insight-card" id="cardPerformers">
            <div class="insight-card-title">Top Performers</div>
            <div class="insight-val" id="cardTopCount">â€”</div>
            <div class="insight-sub" id="cardTopSub">5-star rated employees</div>
            <div class="insight-list" id="cardTopList"></div>
        </div>
        <div class="insight-card" id="cardGrowth">
            <div class="insight-card-title">Growth</div>
            <div class="insight-val" id="cardGrowthVal">â€”</div>
            <div class="insight-sub" id="cardGrowthSub">Hires in rolling 12 months</div>
            <div class="insight-list" id="cardGrowthList"></div>
        </div>
        <div class="insight-card" id="cardPayroll">
            <div class="insight-card-title">Payroll by Dept</div>
            <div class="insight-val" id="cardPayrollVal">â€”</div>
            <div class="insight-sub" id="cardPayrollSub">Total annual payroll</div>
            <div class="insight-list" id="cardPayrollList"></div>
        </div>
    </div>

    <!-- Navigation tiles -->
    <div id="homeTiles">
        <div class="home-tile" onclick="showPage('orgchart')">
            <div class="tile-icon">ğŸŒ³</div>
            <div class="tile-label">Org Chart</div>
            <div class="tile-sub">Visualize &amp; edit your org structure â€” drag-to-reassign, filter by team or department, export to CSV</div>
        </div>
        <div class="home-tile" onclick="showPage('dashboard')">
            <div class="tile-icon">ğŸ“Š</div>
            <div class="tile-label">Dashboard</div>
            <div class="tile-sub">Analytics, risk flags, tenure distribution &amp; workforce insights across your organization</div>
        </div>
    </div>

</div><!-- /pageHome -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: ORG HEALTH -->
<div id="pageOrgHealth" class="page"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: COMPENSATION -->
<div id="pageCompensation" class="page"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: WORKFORCE PLANNING -->
<div id="pageScenarioStudio" class="page"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: ORG CHART -->
<div id="pageOrgchart" class="page">

    <!-- Slim page-level toolbar -->
    <div id="orgPageTop">
        <div id="orgToolbarSearch">
            <div class="toolbar-search-wrap">
                <input type="text" id="globalSearch" list="namesList" placeholder="Search employeeâ€¦"
                       onkeydown="if(event.key==='Enter')focusEmp(this.value)">
            </div>
            <button class="toolbar-search-btn" onclick="focusEmp(g('globalSearch').value)">Search</button>
            <select id="orgDeptFilter" class="toolbar-dept-select" onchange="applyOrgDeptFilter(this.value)"><option value="">All Departments</option></select>
            <button class="toolbar-reset-btn"  onclick="resetOrgView()">â†º Reset</button>
        </div>
    </div>
    <div id="orgReadOnlyBanner">
        Org Chart is read-only. Go to Workforce Planning to model changes.&ensp;<a onclick="showPage('scenarioStudio')" class="org-ro-link">â†’ Open Workforce Planning</a>
    </div>

    <!-- Org chart canvas -->
    <div id="chartWrap">
        <div id="emptyState">
            <div class="ei">ğŸ¢</div>
            <p>Upload a CSV file via the Controls panel to visualize your organization</p>
        </div>
        <div class="chart-container"></div>
    </div>

</div><!-- /pageOrgchart -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: DASHBOARD -->
<div id="pageDashboard" class="page">
    <div id="dashInner">
        <div class="dash-top">
            <div>
                <div class="dash-hl">Canopy <span>Analytics</span></div>
                <div class="dash-sub">Workforce intelligence &amp; org modeling</div>
                <div class="dash-filters">
                    <select id="dDept" onchange="dashFilter('dept')" style="margin-top:0;width:auto;"><option value="">All Departments</option></select>
                    <select id="dMgr"  onchange="dashFilter('team')" style="margin-top:0;width:auto;"><option value="">All Teams</option></select>
                    <button class="toolbar-reset-btn" onclick="resetDashView()">â†º Reset</button>
                </div>
            </div>
        </div>
        <div class="dash-layout">
            <div class="dash-sidebar">
                <div class="msec click" onclick="setDrill('salary')">
                    <div class="ml">ğŸ’° Budget</div>
                    <div class="mr"><span class="mk">Total Payroll</span><span class="mv ac" id="dTotal">â€”</span></div>
                    <div class="mr"><span class="mk">Average Salary</span><span class="mv" id="dAvg">â€”</span></div>
                    <div class="mr"><span class="mk">Median Salary</span><span class="mv" id="dMed">â€”</span></div>
                    <div class="mr"><span class="mk">Range</span><span class="mv" id="dRange">â€”</span></div>
                </div>
                <div class="msec click" onclick="setDrill('tier')">
                    <div class="ml">ğŸ› Strategic Tiers</div>
                    <div id="tierList"></div>
                </div>
                <div class="msec click" onclick="setDrill('rating')">
                    <div class="ml">â­ Performance</div>
                    <div id="perfList"></div>
                </div>
                <div class="msec click" onclick="setDrill('headcount')">
                    <div class="ml">ğŸ¢ Departments</div>
                    <div id="deptList" style="max-height:170px;overflow-y:auto;"></div>
                </div>
                <div class="msec">
                    <div class="ml">ğŸ“ Health Ratios</div>
                    <div class="mr"><span class="mk">Avg Span of Control</span><span class="mv" id="dSpan">â€”</span></div>
                    <div class="mr"><span class="mk">Average Tenure</span><span class="mv" id="dTen">â€”</span></div>
                    <div class="mr"><span class="mk">Rolling 12m Hires</span><span class="mv gr" id="dGrowth">â€”</span></div>
                    <div class="mr"><span class="mk">Top Performers 5â˜…</span><span class="mv gr" id="dTop">â€”</span></div>
                    <div class="mr"><span class="mk">Low Performers â‰¤2</span><span class="mv rd" id="dLow">â€”</span></div>
                </div>
            </div>
            <div class="dash-main">
                <div class="tab-row">
                    <button class="tab-btn active" onclick="swTab(this,'tChart')">ğŸ“Š Chart</button>
                    <button class="tab-btn" onclick="swTab(this,'tTenure')">ğŸ“… Tenure</button>
                    <button class="tab-btn" onclick="swTab(this,'tGeo')">ğŸ“ Locations</button>
                </div>
                <div class="tab-pane active" id="tChart">
                    <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px;flex-shrink:0;" id="chartLbl">Click a metric card to drill in</div>
                    <div style="flex:1;min-height:0;position:relative;">
                        <canvas id="mainChart" style="position:absolute;inset:0;width:100%!important;height:100%!important;"></canvas>
                    </div>
                </div>
                <div class="tab-pane" id="tTenure"></div>
                <div class="tab-pane" id="tGeo"></div>
            </div>
        </div>
    </div>
</div><!-- /pageDashboard -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SPOTLIGHT (fixed) -->
<div id="spotlight">
    <div class="spot-head">
        <div class="spot-name" id="sName">â€”</div>
        <div class="spot-x" onclick="closeSpot()">Ã—</div>
    </div>
    <div class="spot-grid">
        <div class="spot-field full"><div class="sfl">Title</div><div class="sfv" id="sTitle">â€”</div></div>
        <div class="spot-field"><div class="sfl">Manager</div><div class="sfv" id="sMgr">â€”</div></div>
        <div class="spot-field"><div class="sfl">Department</div><div class="sfv" id="sDept">â€”</div></div>
        <div class="spot-field"><div class="sfl">Salary</div><div class="sfv" id="sSal">â€”</div></div>
        <div class="spot-field"><div class="sfl">Level</div><div class="sfv" id="sLvl">â€”</div></div>
        <div class="spot-field"><div class="sfl">Rating</div><div class="sfv" id="sRating">â€”</div></div>
        <div class="spot-field"><div class="sfl">Location</div><div class="sfv" id="sLoc">â€”</div></div>
        <div class="spot-field"><div class="sfl">Tenure</div><div class="sfv" id="sTen">â€”</div></div>
        <div class="spot-field full"><div class="sfl">Email</div><div class="sfv em" id="sEmail">â€”</div></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI PANEL (fixed) -->
<div id="aiPanel">
    <div class="ai-hdr">
        <div class="ai-hdr-row">
            <div class="ai-brand">
                <div class="ai-icon">âœ¦</div>
                <div><div class="ai-ttl">Claude AI</div><div class="ai-sub">Canopy Intelligence Assistant</div></div>
            </div>
            <div class="ai-xbtn" onclick="toggleAI()">Ã—</div>
        </div>
        <div class="ai-stat">
            <div class="ai-dot" id="aiDot" style="background:var(--amber);"></div>
            <span class="ai-stxt" id="aiStxt">Load CSV data to activate</span>
        </div>
    </div>
    <div class="chips-wrap">
        <div class="chips-lbl">Quick Questions</div>
        <div class="chips-row">
            <div class="chip" onclick="chipQ(this)">Top performers?</div>
            <div class="chip" onclick="chipQ(this)">Highest paid dept?</div>
            <div class="chip" onclick="chipQ(this)">Span of control issues</div>
            <div class="chip" onclick="chipQ(this)">Longest tenured?</div>
            <div class="chip" onclick="chipQ(this)">Low-rated managers?</div>
            <div class="chip" onclick="chipQ(this)">Summarize Engineering</div>
            <div class="chip" onclick="chipQ(this)">Workforce health report</div>
            <div class="chip" onclick="chipQ(this)">New hires last 6 months</div>
        </div>
    </div>
    <div id="aiMsgs">
        <div class="ai-welcome">
            <div class="wi">âœ¦</div>
            <p><strong>Ask me anything about your organization.</strong><br><br>I analyze headcount, salaries, performance, tenure, reporting structure, and more â€” all from your loaded CSV.</p>
        </div>
    </div>
    <div class="ai-inp-wrap">
        <div class="ai-inp-row">
            <textarea id="aiInput" placeholder="Ask about your orgâ€¦" rows="1" onkeydown="aiKey(event)" oninput="aiResize(this)"></textarea>
            <button id="aiSend" onclick="sendAI()">â¤</button>
        </div>
        <div class="ai-hint">Powered by Claude Â· Analysis uses your loaded CSV data</div>
    </div>
</div>

<datalist id="namesList"></datalist>

<!-- Scripts: sampleData â†’ state â†’ csv â†’ chart â†’ dashboard â†’ orgHealth â†’ ai â†’ drag â†’ scenarios â†’ scenarioStudio â†’ app -->
<script src="js/sampleData.js"></script>
<script src="js/state.js"></script>
<script src="js/csv.js"></script>
<script src="js/chart.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/orgHealth.js"></script>
<script src="js/compensation.js"></script>
<script src="js/ai.js"></script>
<script src="js/drag.js"></script>
<script src="js/scenarios.js"></script>
<script src="js/scenarioStudio.js"></script>
<script src="js/app.js"></script>
</body>
</html>
